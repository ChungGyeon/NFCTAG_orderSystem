<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íƒœê·¸ì˜¤ë” - ì •í†µ ì¶©ë¶ëŒ€ì§€ì </title>
  <link rel="stylesheet" href="for_menu_modify.css">
</head>
<body>
  <header class="header">
    <div class="top-bar">
    </div>
    <div class="store-info">
      <!--<button class="back-btn">â†</button>ì´ê±° ì–´ë””ì“¸ë§Œí•˜ì§€ì•Šì„ê¹Œ-->
      <h1>ì •ë³´í†µì‹ ê³µí•™ë¶€ ì¶©ë¶ëŒ€ ì§€ì </h1>
      <div class="header-icons">
        <button>ğŸ”—</button>
        <button>ğŸ”</button>
        <button>ğŸ›’</button>
      </div>
    </div>
  </header>

  <nav class="menu-tabs">
    <button>ë©”ë‰´ ì°¾ê¸°</button>
    <button class="active">ì¶”ì²œ ë©”ë‰´</button>
    <button>ì‹ ë©”ë‰´</button>
    <button>bhc ì„¸íŠ¸</button>
    <button>ë¿Œë§í´</button>
    <p>ë²„íŠ¼ì€ ì•„ì§ ì‘ë™ x</p>
  </nav>

  <main class="menu-list">
    <section class="menu-item">
      <div class="menu-info">
        <% items.forEach(item => { %>
          <!--<div class="menu-container" onclick="openModal(<%= item.id %>, '<%= item.name %>', '<%= item.price %>', '<%= item.description %>')">-->
           <div class="menu-container" onclick="loadAdditonalMenu(<%= item.id %>, '<%= item.name %>', '<%= item.price %>', '<%= item.description %>')">
            <div class="menu-details">
            <!--ì•„ë˜ íˆë“ ì€ loadAdditionalMenuê°€ ì—´ì–´ì£¼ëŠ” í˜ì´ì§€ì—ê²Œ ì£¼ê¸° ìœ„í•œ ê±°-->
            <input type="hidden" name="id" value="<%= item.id %>">
            <h2><%= item.name %></h2>
            <p class="price"><%= item.price %>ì›</p>
            <p class="review"><%= item.description %></p>
            <form class="moding_menu_button_addiMenu_label" action ='/ì¶”ê°€ë©”ë‰´ ê±°ì‹œê¸°ë¡œ' method="POST" onsubmit="ì•„ì§í•¨ìˆ˜ëŠ” êµ¬í˜„x;">
                    <input type="hidden" name="id" value="<%= item.id %>">
                    <button class="moding_menu_addiMenu_button" type="submit">ë©”ë‰´ ì˜µì…˜</button>
            </form>
            <form class="moding_menu_button_delete_label" action = '/admin_addel' method="POST" onsubmit="event.preventDefault(); openConfirmModal(this);">
                    <input type="hidden" name="id" value="<%= item.id %>">
                    <button class="moding_menu_delete_button" type="submit">ì‚­ì œ</button>
            </form>
          </div>
            <img class="menu-img" src="/test_img_upload/<%= item.image_url %>" alt="<%= item.name %>">
          </div>
        <% }) %>
      </div>
          <button class="confirm_menu_add" onclick="openAddMenuModal()"> ë©”ë‰´ ì¶”ê°€í•˜ê¸° </button>
    </section>

  <!--ë©”ë‰´ ì¶”ê°€ ì„¹ì…˜ : ì´ë¦„,ê°€ê²©,ì„¤ëª…,ì´ë¯¸ì§€ ìˆœìœ¼ë¡œ í•˜ë‚˜ì”© ëª¨ë‹¬ì´ ë‚˜ì˜´, ì¶”í›„ jsë¡œ ë¦¬í™í† ë§ ìŒ‰ê°€ëŠ¥-->
   <div id="menu_add_section" class="menu-add-step">
       <section>
           <div id="menu-add-name" class="menu-add-modal">
               <span class="close" onclick="closeAddMenuModal()">&times;</span>
               <h2>ë©”ë‰´ ì¶”ê°€ - ì²«ë²ˆì§¸!</h2><br>
               <h3>ì¶”ê°€í•  ë©”ë‰´ì˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!</h3><br>
               <input type="text" id="menu-add-name-textarea" name="name" required><br>
               <button class="confirm_menu_add--stepbutton" onclick="step2AddMenuModal()">ë‹¤ìŒ</button>
           </div>
       </section>
        <section>
            <div id="menu-add-price" class="menu-add-step">
                <span class="close" onclick="closeAddMenuModal()">&times;</span>
                <h2>ë©”ë‰´ ì¶”ê°€ - ë‘ë²ˆì§¸!</h2><br>
                <h3>ë©”ë‰´ì˜ ê°€ê²©ì„ ì •í•´ì£¼ì„¸ìš”!</h3>
                <input type="text" id="menu-add-price-textarea" name="price" required><br>
                <button class="confirm_menu_add--stepbutton" onclick="step3AddMenuModal()">ë‹¤ìŒ</button>
            </div>
        </section>

        <section>
            <div id="menu-add-description" class="menu-add-step">
                 <span class="close" onclick="closeAddMenuModal()">&times;</span>
                 <h2>ë©”ë‰´ ì¶”ê°€ - ì„¸ë²ˆì§¸!</h2><br>
                 <h3>ì†ë‹˜ë“¤ì—ê²Œ ë©”ë‰´ì˜ ì„¤ëª…ì´ í•„ìš”í•´ìš”!</h3>
                 <input type="text" id="menu-add-description-textarea" name="description" required><br>
                 <button class="confirm_menu_add--stepbutton" onclick="step4AddMenuModal()">ë‹¤ìŒ</button>
            </div>
        </section>

        <section>
          <div id="menu-add-imgupload" class="menu-add-step">
               <span class="close" onclick="closeAddMenuModal()">&times;</span>
               <h1>ë©”ë‰´ ì¶”ê°€ - ë§ˆì§€ë§‰!</h1><br>
               <h2>ë§ˆì§€ë§‰ìœ¼ë¡œ ë©”ë‰´ë¥¼ ë©‹ì§„ ì‚¬ì§„ìœ¼ë¡œ ê¾¸ë©°ë³¼ê¹Œìš”?</h2><br>
               <!--<form id="imge_UploadForm" action="/Storeimg_upload" method="POST" enctype="multipart/form-data"></form>-->
                   <input type="file" name="myFile" id="imageInput" accept="image/*" onchange="previewImage()" />
                   <input type="text" id="imageText" required readonly/>
                   <div id="previewContainer" style="margin-top: 10px;">
                       <img id="imagePreview" style="max-width: 300px; display: none;" />
                       <p id="confirm-textPreview"></p>
                   </div>
                   <button type="button" id="previewButton" onclick="previewImage()">Preview</button>
                   <button type="button" id="uploadButton" style="display: none;" onclick="uploadImage()">Upload to Server</button>

                   <button class="confirm_menu_add--stepbutton" onclick="step5AddMenuModal()">ë§ˆì§€ë§‰</button>
               </form>
          </div>
        </section>

       <section>
           <div id="confirm_menu_add_process" class="menu-add-step">
               <span class="close" onclick="closeAddMenuModal()">&times;</span>
               <h1>í™•ì¸í•´ë³¼ê¹Œìš”?</h1><br>
               <div id="confirm-img" style="margin-top: 10px;">
                   <img id="confirm-img-preview" style="max-width: 300px; display: none;" />
                   <p id="textPreview"></p>
               </div>

               <h2>ë©”ë‰´ ì´ë¦„ : <span id="menu-name-confirm-text"></span></h2>
               <h2>ë©”ë‰´ ê°€ê²© : <span id="menu-price-confirm-text"></span></h2>
               <h2>ë©”ë‰´ ì„¤ëª… : <span id="menu-description-confirm-text"></span></h2>

               <!-- ì…ë ¥ í•„ë“œ -->
               <input type="hidden" id="menu-name-confirm-input" name="name">
               <input type="hidden" id="menu-price-confirm-input" name="price">
               <input type="hidden" id="menu-description-confirm-input" name="description">

               <button class="confirm_menu_add--stepbutton" onclick="uploadMenu()">ë©”ë‰´ ì¶”ê°€</button>
           </div>
       </section>
   </div>

   <!--ì‚­ì œ í™•ì¸ ëª¨ë‹¬, ê´€ë ¨ ìŠ¤í¬ë¦½ í•¨ìˆ˜(openConfirmModal, closeConfirModal, confirmDelete)-->
    <section>
        <div id="confirmModal" class="confirm-modal">
          <div class="confirm-modal-content">
            <span class="close" onclick="closeConfirmModal()">&times;</span>
               <p>ì •ë§ë¡œ ì‚­ì œí•˜ê² ìŠµë‹ˆê¹Œ?</p>
               <div class="confirm-modal-buttons">
                 <button onclick="confirmDelete()">í™•ì¸</button>
                 <button onclick="closeConfirmModal()">ì·¨ì†Œ</button>
               </div>
          </div>
        </div>
    </section>

     <!--ì¶”ê°€ë©”ë‰´ ê´€ë ¨ ëª¨ë‹¬-->
      <div id="additionalMenu_section" class="modal">
       <section>
        <div class="modal-content">
          <span class="close" onclick="closeAddMenuModal();">&times;</span>
          <h2 id="modal-menu-name"></h2>
          <p id="modal-price"></p>
          <p id="modal-description"></p>
          <div id="modal-options"></div>
          <input type="hidden" id="menu_id" required readonly/>
          <button class="addToPlusMenu" onclick="openAdditionalMenuModal(document.getElementById('menu_id').value,document.getElementById('modal-menu-name').innerText,document.getElementById('modal-price').innerText)">
              ì˜µì…˜ ì¶”ê°€
          </button>
        </div>
       </section>
       <section>
           <div id="additionalMenu_modal" class="additionalMenu_modal_section">
               <!--ì´ xë²„íŠ¼ì€ íŠ¹ë³„íˆ ì „ ë‹¨ê³„ë¡œ ëŒì•„ê°€ëŠ” ê²ƒìœ¼ë¡œ ë§Œë“¦-->
               <span class="close" onclick="document.getElementById('additionalMenu_modal').style.display = 'none';">&times;</span>
               <!--ì¶”ê°€ë©”ë‰´ ì „ì†¡ í…œí”Œë¦¿, targetOfAdditionalMenu_idëŠ” openAdditionalMenuModal()(366line)ì„ ì°¸ì¡°-->
               <form id="option_imge_UploadForm" action="/test_adTooption" method="POST">
                   <input type="hidden" name="targetOfAdditionalMenu_id" id="targetOfAdditionalMenu_id"/>
                   <H2>ì„ íƒí•œ ë©”ë‰´ :</H2><H1 id="MenuName"></H1><br>
                   <label for="name">ì„¤ì •í•  ì˜µì…˜ ì´ë¦„:</label>
                   <input type="text" id="name" name="name" required><br><br>
                   <label for="additional_price">ì˜µì…˜ ê°€ê²©:</label>
                   <input type="number" id="additional_price" name="additional_price" step="1" required><br><br>
                   <label for="description">ì˜µì…˜ ì„¤ëª…:</label>
                   <textarea id="description" name="description" required></textarea><br><br>
                   <button type="submit">Add Option</button>
               </form>
           </div>
       </section>
      </div>

  </main>


  <!--ëª¨ë‹¬ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸, ë‚˜ì¤‘ì— jsíŒŒì¼ë¡œ ë”°ë¡œ ë¹¼ë†“ì„ ê²ƒ-->
  <script>
    let addForm;
    /*ë©”ë‰´ ì¶”ê°€ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜*/
    function openAddMenuModal() {
        document.getElementById('menu_add_section').style.display = 'block';
        document.getElementById('menu-add-name').style.display = 'block';
    }

    function step2AddMenuModal() {
        document.getElementById('menu-add-name').style.display = 'none';
        document.getElementById('menu-add-price').style.display = 'block';
    }

    function step3AddMenuModal() {
        document.getElementById('menu-add-price').style.display = 'none';
        document.getElementById('menu-add-description').style.display = 'block';
    }
    function step4AddMenuModal() {
        document.getElementById('menu-add-description').style.display = 'none';
        document.getElementById('menu-add-imgupload').style.display = 'block';
    }
    function step5AddMenuModal() {
        document.getElementById('menu-add-imgupload').style.display = 'none';

        const confirmImgPreview = document.getElementById('confirm-img-preview');
              const confirmTextPreview = document.getElementById('confirm-textPreview');
              const textInput = document.getElementById('imageText');

              if (imagePreview) {
                    confirmImgPreview.src = imagePreview.src;
                    confirmImgPreview.style.display = 'block';
                    }
                  confirmTextPreview.textContent = textInput.value;
        const name = document.getElementById('menu-add-name-textarea').value;
        const price = document.getElementById('menu-add-price-textarea').value;
        const description = document.getElementById('menu-add-description-textarea').value;

        //í™”ë©´ í‘œì‹œìš©
        document.getElementById('menu-name-confirm-text').innerText = name;
        document.getElementById('menu-price-confirm-text').innerText = price;
        document.getElementById('menu-description-confirm-text').innerText = description;

        //ì„œë²„ ì „ì†¡ìš©
        document.getElementById('menu-name-confirm-input').value = name;
        document.getElementById('menu-price-confirm-input').value = price;
        document.getElementById('menu-description-confirm-input').value = description;

        document.getElementById('confirm_menu_add_process').style.display = 'block';
    }

    function closeAddMenuModal() {
        document.getElementById('menu_add_section').style.display = 'none';
        document.getElementById('menu-add-name').style.display = 'none';
        document.getElementById('menu-add-price').style.display = 'none';
        document.getElementById('menu-add-description').style.display = 'none';
        document.getElementById('menu-add-imgupload').style.display = 'none';
        document.getElementById('confirm_menu_add_process').style.display = 'none';
        document.getElementById('additionalMenu_section').style.display = 'none';
      }


    /*ê´€ë¦¬ì í˜ì´ì§€ì—ëŠ” ì¼ë‹¨ ëª¨ë‹¬ ìƒì„±, ë©”ë‰´ ì£¼ë¬¸ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì¼ë‹¨ ì‚­ì œ, ì•„ì°¨í”¼ ìˆ˜ì •,ì‚­ì œê°€ ì£¼ëª©ì ì¸ë°*/
    let deleteForm;

     /*ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜*/
      function openConfirmModal(form) {
        deleteForm = form;
        document.getElementById('confirmModal').style.display = 'block';
      }

      function closeConfirmModal() {
        document.getElementById('confirmModal').style.display = 'none';
      }

      function confirmDelete() {
        deleteForm.submit();
      }

    //ì´ë¯¸ì§€ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸
    let selectedFile = null;
    let imagePreview = null;
    function previewImage() {
        const imageInput = document.getElementById('imageInput');
        imagePreview = document.getElementById('imagePreview');
        const textInput = document.getElementById('imageText');
        const textPreview = document.getElementById('textPreview');
        const uploadButton = document.getElementById('uploadButton');

        // íŒŒì¼ì´ ì œëŒ€ë¡œ ë“¤ì–´ì™”ëŠ”ì§€ í™•ì¸
        if (imageInput.files && imageInput.files[0]) {
            selectedFile = imageInput.files[0];

            //íŒŒì¼ì´ë¦„ì„ í…ìŠ¤íŠ¸ì˜ì—­ì— í• ë‹¹
            textInput.value = selectedFile.name;

            // ì´ë¯¸ì§€ í”„ë¦¬ë·° ì œê³µ ìŠ¤í¬ë¦½íŠ¸
            const reader = new FileReader();
            reader.onload = function (e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
            };
            reader.readAsDataURL(selectedFile);

            // ì´ë¯¸ì§€ ì´ë¦„ ë¯¸ë¦¬ë³´ê¸°
            textPreview.textContent = textInput.value;

            // ì—…ë¡œë“œ ë²„íŠ¼
            uploadButton.style.display = 'inline-block';
        } else {
            alert('Please select an image first!');
        }
    }

    //ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì‹œ ì„œë²„ì— ì´ë¯¸ì§€,ë©”ë‰´ í…ìŠ¤íŠ¸ ì¸í¬ë¥¼ ì„œë²„ì— ì „ì†¡ ë° ì €ì¥
    function uploadMenu() {
        const formData = new FormData();
        //const fileInput = document.getElementById('menu-img-confirm-input');
        const fileInput = document.getElementById('imageInput');
        const nameInput = document.getElementById('menu-name-confirm-input');
        const priceInput = document.getElementById('menu-price-confirm-input');
        const descInput = document.getElementById('menu-description-confirm-input');

        formData.append('myFile', fileInput.files[0]);
        formData.append('name', nameInput.value);
        formData.append('price', priceInput.value);
        formData.append('description', descInput.value);

        fetch('/addToMenuInfo', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                    return response.text();
                }
            })
            .then(data => {
                if (data) console.log('ì„œë²„ ì‘ë‹µ:', data);
            })
            .catch(error => {
                console.error('ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
            });
    }


    //ì¶”ê°€ë©”ë‰´ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸
    //ì¶”ê°€ë©”ë‰´ ì •ë³´ ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸
    function loadAdditonalMenu(id, name, price, description) {
        let selectedMenu = '';//ì„ íƒí•œ ë©”ë‰´ ì´ë¦„ ì €ì¥
        let selectedMenuPrice = 0;
        selectedMenu=name;
        selectedMenuPrice = parseInt(price, 10); // ê°€ê²©ì„ ì •ìˆ˜ë¡œ ë³€í™˜
        document.getElementById('menu_id').value = id;
        document.getElementById('modal-menu-name').textContent = name;
        document.getElementById('modal-price').textContent = price + 'ì›';
        document.getElementById('modal-description').textContent = description;
        document.getElementById('additionalMenu_section').style.display = 'block';
        // ëª¨ë‹¬ì„ ì—´ë©´ ê·¸ ë©”ë‰´ì— ë§ëŠ” ì˜µì…˜ë“¤ì„ ê°€ì ¸ì˜´
        fetch(`/getMenuOptions?id=${id}`)
            .then(response => response.json())
            .then(data => {
                console.log('ì˜µì…˜ ë°ì´í„°:', data.options);
                const optionsContainer = document.getElementById('modal-options');
                optionsContainer.innerHTML = ''; // ì´ì „ì˜µì…˜ì„ ì´ˆê¸°í™”
                data.options.forEach(option => {
                    const label = document.createElement('label');
                    label.innerHTML = `<p class="additionalMenu_section"><input type="hidden" id="option-${option.id}" data-price="${option.additional_price}">${option.name} (${option.additional_price}ì›)</input>
                    <button>ì‚­ì œ</button><button>ìˆ˜ì •</button>`;
                    optionsContainer.appendChild(label);
                });
            })
            .catch(error => {
                console.error('ì¶”ê°€ì˜µì…˜ì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. :', error);
            });
    }

    function openAdditionalMenuModal(id,menuName,price){
        /*ê°,additionalMenu_modalì„ í™œì„±í™”,
        loadAdditonalMenu()ì—ì„œ additionalMenu_section ì„¹ì…˜ìœ¼ë¡œ idë¥¼ ë„˜ê²¨ì£¼ê³  ì´ë¥¼ openAdditionalMenuModal()ì•ˆì— ë„£ì–´ targetOfAdditionalMenu_idë¡œ ê°€ì ¸ì˜¨ menu_id,
        MenuNameì€ additionalMenu_sectionì—ì„œ id=modal-menu-nameì˜ ì •ë³´ë¥¼ ê·¸ëŒ€ë¡œ ë„˜ê²¨ë°›ì•„ ì˜´
        * */
        document.getElementById('additionalMenu_modal').style.display = 'block';
        document.getElementById('targetOfAdditionalMenu_id').value = id;
        document.getElementById('MenuName').textContent=menuName;
    }

</script>
</body>
</html>